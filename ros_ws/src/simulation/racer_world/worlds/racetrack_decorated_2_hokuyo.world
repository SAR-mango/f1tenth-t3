<?xml version="1.0" encoding="UTF-8"?>
<sdf version="1.4">
    <world name="racetrack">
        <scene>
            <shadows>1</shadows>
            <grid>0</grid>
            <origin_visual>0</origin_visual>
            <sky></sky>
        </scene>
        <physics type="ode" default="true">
            <!-- Default physics profile with no changes -->
        </physics>
        <physics name="fast_simulation" type="ode" default="false">
            <real_time_update_rate>0</real_time_update_rate>
        </physics>

        <include>
            <uri>https://fuel.gazebosim.org/1.0/OpenRobotics/models/Sun</uri>
        </include>

        <gui>
            <camera name="my_camera">
                <pose>-3.2 7.8 31 0 1.5707963 1.5707963</pose>
            </camera>
        </gui>
        
        <model name="track">
            <pose>0 0 0.01  0 0 0</pose>
            <static>true</static>
            <link name="track">
                <visual name="visual">
                <geometry>
                    <!-- Relative path defined in package.xml -->
                    <mesh><uri>../meshes/track_decorated_2.dae</uri></mesh>
                </geometry>
                </visual>
                <collision name="collision">
                    <geometry>
                        <plane>
                            <normal>0 0 1</normal>
                            <size>100 100</size>
                        </plane>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100</mu>
                                <mu2>50</mu2>
                            </ode>
                        </friction>
                    </surface>
                </collision>
            </link>
            <link name="walls-collision-link">
                <collision name="walls-collision">
                    <geometry>
                        <!-- Relative path defined in package.xml -->
                        <mesh><uri>../meshes/walls.dae</uri></mesh>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100</mu>
                                <mu2>50</mu2>
                            </ode>
                        </friction>
                    </surface>
                </collision>
                <sensor name='walls-contact-sensor' type='contact'>
                    <contact>
                        <collision>walls-collision</collision>
                    </contact>
                </sensor>
            </link>
            <link name="decoration-collision-link">
                <collision name="decoration-collision">
                    <geometry>
                        <!-- Relative path defined in package.xml -->
                        <mesh><uri>../meshes/decoration_colliders_2.dae</uri></mesh>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100</mu>
                                <mu2>50</mu2>
                            </ode>
                        </friction>
                    </surface>
                </collision>
                <sensor name='decoration-contact-sensor' type='contact'>
                    <contact>
                        <collision>decoration-collision</collision>
                    </contact>
                </sensor>
            </link>
        </model>
            
        <model name='car'>
            <pose>0.20 0.015 0.07 0 -0 0</pose>

            <link name='chassis'>
                <pose>-0.030113 0 0.030771 0 -0 0</pose>
                <inertial>
                <mass>1.14395</mass>
                <inertia>
                    <ixx>0.126164</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.416519</iyy>
                    <iyz>0</iyz>
                    <izz>0.481014</izz>
                </inertia>
                </inertial>
                <visual name='visual'>
                <geometry>
                    <box>
                    <size>0.4 0.2 0.1</size>
                    </box>
                </geometry>
                <material>
                    <ambient>0.5 0.5 1.0 1</ambient>
                    <diffuse>0.5 0.5 1.0 1</diffuse>
                    <specular>0.0 0.0 1.0 1</specular>
                </material>
                </visual>
                <collision name='collision'>
                <geometry>
                    <box>
                    <size>0.4 0.2 0.1</size>
                    </box>
                </geometry>
                </collision>
            </link>

            <link name='front_left_wheel'>
                <pose>0.110227 0.125006 -0.004396 -1.5707 0 0</pose>
                <inertial>
                <mass>2</mass>
                <inertia>
                    <ixx>0.145833</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.145833</iyy>
                    <iyz>0</iyz>
                    <izz>0.125</izz>
                </inertia>
                </inertial>
                <visual name='visual'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>0.2 0.2 0.2 1</ambient>
                    <diffuse>0.2 0.2 0.2 1</diffuse>
                    <specular>0.2 0.2 0.2 1</specular>
                </material>
                </visual>
                <collision name='collision'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <surface>
                    <friction>
                    <ode>
                        <mu>0.5</mu>
                        <mu2>1.0</mu2>
                        <fdir1>0 0 1</fdir1>
                    </ode>
                    </friction>
                </surface>
                </collision>
            </link>

            <link name='rear_left_wheel'>
                <pose>-0.190341 0.125006 -0.004396 -1.5707 0 0</pose>
                <inertial>
                <mass>2</mass>
                <inertia>
                    <ixx>0.145833</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.145833</iyy>
                    <iyz>0</iyz>
                    <izz>0.125</izz>
                </inertia>
                </inertial>
                <visual name='visual'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>0.2 0.2 0.2 1</ambient>
                    <diffuse>0.2 0.2 0.2 1</diffuse>
                    <specular>0.2 0.2 0.2 1</specular>
                </material>
                </visual>
                <collision name='collision'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <surface>
                    <friction>
                    <ode>
                        <mu>0.5</mu>
                        <mu2>1.0</mu2>
                        <fdir1>0 0 1</fdir1>
                    </ode>
                    </friction>
                </surface>
                </collision>
            </link>

            <link name='front_right_wheel'>
                <pose>0.110227 -0.125006 -0.004396 -1.5707 0 0</pose>
                <inertial>
                <mass>2</mass>
                <inertia>
                    <ixx>0.145833</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.145833</iyy>
                    <iyz>0</iyz>
                    <izz>0.125</izz>
                </inertia>
                </inertial>
                <visual name='visual'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>0.2 0.2 0.2 1</ambient>
                    <diffuse>0.2 0.2 0.2 1</diffuse>
                    <specular>0.2 0.2 0.2 1</specular>
                </material>
                </visual>
                <collision name='collision'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <surface>
                    <friction>
                    <ode>
                        <mu>0.5</mu>
                        <mu2>1.0</mu2>
                        <fdir1>0 0 1</fdir1>
                    </ode>
                    </friction>
                </surface>
                </collision>
            </link>

            <link name='rear_right_wheel'>
                <pose>-0.190341 -0.125006 -0.004396 -1.5707 0 0</pose>
                <inertial>
                <mass>2</mass>
                <inertia>
                    <ixx>0.145833</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.145833</iyy>
                    <iyz>0</iyz>
                    <izz>0.125</izz>
                </inertia>
                </inertial>
                <visual name='visual'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>0.2 0.2 0.2 1</ambient>
                    <diffuse>0.2 0.2 0.2 1</diffuse>
                    <specular>0.2 0.2 0.2 1</specular>
                </material>
                </visual>
                <collision name='collision'>
                <geometry>
                    <cylinder>
                    <length>0.03</length>
                    <radius>0.056098</radius>
                    </cylinder>
                </geometry>
                <surface>
                    <friction>
                    <ode>
                        <mu>0.5</mu>
                        <mu2>1.0</mu2>
                        <fdir1>0 0 1</fdir1>
                    </ode>
                    </friction>
                </surface>
                </collision>
            </link>

            <link name="front_left_wheel_steering_link">
                <pose>0.110227 0.1 0.003517 0 0 0</pose>
                <inertial>
                <mass>0.5</mass>
                <inertia>
                    <ixx>0.0153</ixx>
                    <iyy>0.025</iyy>
                    <izz>0.0153</izz>
                </inertia>
                </inertial>
                <visual name="steering_link_visual">
                <pose>0 0 0 0 0 0</pose>
                <geometry>
                    <cylinder>
                    <length>0.017583</length>
                    <radius>0.005983</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1 1 1</ambient>
                    <diffuse>1 1 1</diffuse>
                </material>
                </visual>
            </link>

            <link name="front_right_wheel_steering_link">
                <pose>0.110227 -0.1 0.003517 0 0 0</pose>
                <inertial>
                <mass>0.5</mass>
                <inertia>
                    <ixx>0.0153</ixx>
                    <iyy>0.025</iyy>
                    <izz>0.0153</izz>
                </inertia>
                </inertial>
                <visual name="steering_link_visual">
                <pose>0 0 0 0 0 0</pose>
                <geometry>
                    <cylinder>
                    <length>0.017583</length>
                    <radius>0.005983</radius>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1 1 1</ambient>
                    <diffuse>1 1 1</diffuse>
                </material>
                </visual>
            </link>

            <joint name="front_left_wheel_steering_joint" type="revolute">
                <child>front_left_wheel_steering_link</child>
                <parent>chassis</parent>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-0.6</lower>
                    <upper>+0.6</upper>
                    <velocity>1.0</velocity>
                    <effort>25</effort>
                </limit>
                <use_parent_model_frame>1</use_parent_model_frame>
                </axis>
            </joint>

            <joint name="front_right_wheel_steering_joint" type="revolute">
                <parent>chassis</parent>
                <child>front_right_wheel_steering_link</child>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-0.6</lower>
                    <upper>+0.6</upper>
                    <velocity>1.0</velocity>
                    <effort>25</effort>
                </limit>
                </axis>
            </joint>

            <joint name='front_left_wheel_joint' type='revolute'>
                <parent>front_left_wheel_steering_link</parent>
                <child>front_left_wheel</child>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
                </axis>
            </joint>

            <joint name='front_right_wheel_joint' type='revolute'>
                <parent>front_right_wheel_steering_link</parent>
                <child>front_right_wheel</child>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
                </axis>
            </joint>

            <joint name='rear_left_wheel_joint' type='revolute'>
                <parent>chassis</parent>
                <child>rear_left_wheel</child>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
                </axis>
            </joint>

            <joint name='rear_right_wheel_joint' type='revolute'>
                <parent>chassis</parent>
                <child>rear_right_wheel</child>
                <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
                </axis>
            </joint>

            <!-- Hokuyo UST-10LX model (visual + sensor) from Fuel -->
            <include>
                <name>hokuyo</name>
                <uri>https://fuel.gazebosim.org/1.0/mjcarroll/models/Hokuyo UST10LX</uri>

                <!-- Mount at the same place as the old cylinder (lidar_frame). -->
                <!-- The Fuel modelâ€™s sensor is at +0.0525045525m in its model.sdf,
                    so we shift the whole model down by that amount so the scan plane
                    is at lidar_frame height. -->
                <pose relative_to="lidar_frame">0 0 -0.0525045525 0 0 0</pose>
            </include>

            <!-- Rigidly attach the included model to the car chassis -->
            <joint name="hokuyo_mount_fixed" type="fixed">
                <parent>chassis</parent>
                <child>hokuyo::link</child>
            </joint>


            <!-- Lidar Frame-->
            <frame name="lidar_frame" attached_to="chassis">
                <!-- x y z roll pitch yaw; set z to the mounting height -->
                <pose>0.08 0 0.10 0 0 0</pose>
            </frame>

            <!-- ACKERMANN STEERING PLUGIN -->
            <plugin
                filename="ignition-gazebo-ackermann-steering-system"
                name="gz::sim::systems::AckermannSteering">
                <left_joint>front_left_wheel_joint</left_joint>
                <left_joint>rear_left_wheel_joint</left_joint>
                <right_joint>front_right_wheel_joint</right_joint>
                <right_joint>rear_right_wheel_joint</right_joint>
                <left_steering_joint>front_left_wheel_steering_joint</left_steering_joint>
                <right_steering_joint>front_right_wheel_steering_joint</right_steering_joint>
                <kingpin_width>0.2</kingpin_width>
                <steering_limit>0.5</steering_limit>
                <wheel_base>0.198864</wheel_base>
                <wheel_separation>0.25</wheel_separation>
                <wheel_radius>0.056098</wheel_radius>
                <min_velocity>-1</min_velocity>
                <max_velocity>1</max_velocity>
                <min_acceleration>-3</min_acceleration>
                <max_acceleration>3</max_acceleration>
            </plugin>

        </model>
    </world>

    <!-- SENSOR PLUGIN -->
    <plugin
        filename="libignition-gazebo-sensors-system.so"
        name="ignition::gazebo::systems::Sensors">
        <render_engine>ogre2</render_engine>
    </plugin>

</sdf>
